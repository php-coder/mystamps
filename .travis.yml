dist: xenial
language: java

env:
  global:
    - MAVEN_OPTS='-Xss256k'
    - secure: "fBav56BzY+A+Vs1g9YSfo1oLDCO1rFrXl49lJkOA5/XpnsKEEs4lI2RcOzz0wiJKXFNgcliiAJWoYMI8Esqz+lkyFWan4ij5Co0UzJcytDuY+2o+jaqwx45DuDYPogABzT+hWjLCxQLLG46gUkChzT8kcvOOn6JxC7Ff8q5MnoM="

# travis_terminate is used for getting a fail-fast behavior and don't abort the execution of the Travis scripts.
# See https://travis-ci.community/t/log-are-truncated-when-my-script-exits-abnormally/5878
before_script:
  - trap 'travis_terminate 1' ERR;
    pip install --user ansible==2.9.27;

script:
  - mvn clean package

deploy:
  provider: script
  script: ./src/main/scripts/ci/deploy.sh
  on:
    branch: prod
    condition: '"$TRAVIS_PULL_REQUEST" = "false"'
  skip_cleanup: true

jdk:
  - openjdk8

cache:
  directories:
  - $HOME/.m2

branches:
  only:
  - prod

notifications:
  email:
    on_success: always # default: change
    on_failure: always # default: always

# We don't want to run `mvn install -DskipTests=true` for downloading project's dependencies
install: true
