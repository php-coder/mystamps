# Bugs, workarounds and project's decisions

| Date/Type | Description |
| --------- | ----------- |
| ~~09.07.2022 Workaround~~ | ~~[php-coder/mystamps#1533](https://github.com/php-coder/mystamps/issues/1533): After update of **html5validator** to 0.4.2, it has turned out that, starting from 0.4.0, it requires **Python** 3.6 that we don't have on Travis CI as we still on the old Ubuntu 16.04. Until we migrate to 20.04. (see [php-coder/mystamps#1467](https://github.com/php-coder/mystamps/issues/1467)), I decided to install Python 3.6 manually. Commits: [0e09fac8](https://github.com/php-coder/mystamps/commit/0e09fac8663d6642e13c7c413d550da163d4fa95)~~<br />UPDATE(03.12.2022): in [d2110ff6](https://github.com/php-coder/mystamps/commit/d2110ff651e84a32e25cc83cd4208d357f59791c) commit I reverted this workaround because it's no longer required: as part of migration to GitHub Actions ([php-coder/mystamps#1154](https://github.com/php-coder/mystamps/issues/1154)), since commit [661444c6](https://github.com/php-coder/mystamps/commit/661444c62d91694b628351b34724fdc6d999f5a4) we use a container with Ubuntu 20.04 and Python 3.8.10 |
| 22.01.2022 Workaround | [php-coder/mystamps#1549](https://github.com/php-coder/mystamps/issues/1549): During update of **Liquibase** from 4.5.0 to 4.7.1 a new issue has been popped up: starting from 4.7.1 it logs all applied migrations to the console. And it seems like it logs directly and it doesn't respect logger configuration. It has a low impact to production but in test environment it spams a lot as we always apply all existing migrations. Moreover, it also affects unit tests where we use in-memory database. I raised this question in upstream (see my comments in [liquibase/liquibase#2200](https://github.com/liquibase/liquibase/pull/1932#discussion_r790117453)) but it might be an issue on our side as we use the latest Liquibase and (very old) Spring Boot 2.1.18 Commits: [f3c2e20d](https://github.com/php-coder/mystamps/commit/f3c2e20d1ba78703f53b6b090bfe7f7257e34a04)<br />UPDATE(24.01.2022): Bug: [liquibase/liquibase#2396](https://github.com/liquibase/liquibase/issues/2396) |
| 10.11.2021 Workaround | [php-coder/mystamps#1549](https://github.com/php-coder/mystamps/issues/1549): During update of **Liquibase** from 4.5.0 to 4.6.1 the bug has been faced -- the migration `0.4/2017-05-29--test_image.xml` has started to fail with error `BLOB resource not found: /test/test.png`. I postponed this update and filled a bug report to upstream. Bug: [liquibase/liquibase#2200](https://github.com/liquibase/liquibase/issues/2200)<br />UPDATE(22.01.2022): in [f3c2e20d](https://github.com/php-coder/mystamps/commit/f3c2e20d1ba78703f53b6b090bfe7f7257e34a04) I have updated Liquibase to the latest version and also I applied a workaround by specifying a relative path instead of an absolute one. The future of the bug report isn't clear at this moment: it's definitely broke the backward compatibility and even a workaround requires us to modify the existing migration (that we mustn't do! but we can as this particular migration is used only by tests). From another hand, this change was made intentionally and it might stay with us forever |
| 02.07.2021 Workaround | Enablement of `GuardLogStatement` in **PMD** led to a few false positives when we concatenate constant string literals. This should be fixed in PMD >= 6.36.0 but until we have this version (see [php-coder/mystamps#1250](https://github.com/php-coder/mystamps/issues/1250)), I suppressed violations manually. Bug: [pmd/pmd#957](https://github.com/pmd/pmd/issues/957) Commits: [0b135cb4](https://github.com/php-coder/mystamps/commit/0b135cb41f2da6d5ffc6570acf0ae68db35295f7) |
| ~~02.07.2021 Workaround~~ | ~~[php-coder/mystamps#1536](https://github.com/php-coder/mystamps/issues/1536): `pip install robotframework-lint` has started to fail in TravisCI because one of the transitive dependencies (**robotframework-lint** -> robotframework -> ruamel.yaml.clib 0.2.4) requires at least **Python** 3.5 In order to unbreak the builds, I pinned the version of `robotframework` but it wasn't enough. Then I pinned the version of **ruamel.yaml.clib** to the latest worked version 0.2.2 Commits: [6c0180cb](https://github.com/php-coder/mystamps/commit/6c0180cb8c90df0d8239b123094ac7d9dd7d29f0), [8447ddb2](https://github.com/php-coder/mystamps/commit/8447ddb2f4944906a97619c9964afff3e2ff7842), [e6186331](https://github.com/php-coder/mystamps/commit/e61863319fdef76417f0e1a31b430aad10226748)~~<br/>UPDATE(10.07.2022): since [0e09fac8](https://github.com/php-coder/mystamps/commit/0e09fac8663d6642e13c7c413d550da163d4fa95) we have Python 3.6 installed and this workaround is no longer needed. I removed it in [bae944a](https://github.com/php-coder/mystamps/commit/bae944ac077d2827e61c85967c69d51ac532c266) |
| 09.01.2021 Decision | [php-coder/mystamps#1495](https://github.com/php-coder/mystamps/issues/1495): Let's move **generated images** for the diagrams to the separate branch (`generated-assets`). Later we can apply this approach for other generated content (reports, for example). Pros: it reduces a disk space/repository size because we always hold only the latest version of the images. We will use force-push for rewriting data. Cons: it makes diagram update (especially with PRs) a little more complex because it requires 2 commits (PRs). Commits: [6e7e149f](https://github.com/php-coder/mystamps/commit/6e7e149f84756a6fd817dc23e6e80c145783c784) |
| 20.06.2020 Decision | When I released 0.4 version after 5 years of development, I decided to [**make releases often**](https://en.wikipedia.org/wiki/Release_early,_release_often): every 3 months. In case when some planned issues haven't been implemented, they should be postponed to the next release and they shouldn't delay a release. Starting from 0.4.5 I've decided to make releases even more frequently -- *every 2 months*. This will improve our confidence that the release procedures are up-to-date. |
| 20.06.2020 Decision | [php-coder/mystamps#1159](https://github.com/php-coder/mystamps/issues/1159): based on experience, most of time when I made a dependency update, I spent on reading a list of changes. This came especially notable with Spring Boot updates when reading might took 85-90% of time because I had to read also changelogs of Spring Framework, Spring Security and sometimes other libraries. As a consequence of this approach, at this moment, we use old and unsupported Spring Boot version (2.0.x) while the current one is 2.3.x Decision: in order to keep up with new releases, we should sacrify the pedancy and a full understanding of the changes that happen with our dependencies. **Reading of changelogs** should be an optional and if an update passed the integration tests, this is enough level of confidence. |
| 23.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): unfortunately, by default double quotes work differently on **MySQL** (the arguments are treated as strings) in contrast to other databases and our "fix" fixed nothing. To have a similar behavior we can set `sql_mode` to [`ANSI_QUOTES`](https://dev.mysql.com/doc/refman/5.7/en/sql-mode.html#sqlmode_ansi_quotes). Workaround: let's simply rename the field from `condition` to `cond` because additional configuration of a database (or [a connection](https://stackoverflow.com/questions/58727070/how-to-dynamic-setting-sql-mode-for-mysql-in-springboot-program)) unnecessary complicates the setup. See also: [When to use single quotes, double quotes, and backticks in MySQL]( https://stackoverflow.com/questions/11321491/when-to-use-single-quotes-double-quotes-and-backticks-in-mysql). Extra decision: let's keep `DATABASE_TO_UPPER=false` parameter for **H2** as I prefer to see tables names in a lower case. Commits: [89ba68c0](https://github.com/php-coder/mystamps/commit/89ba68c0e11d59da55404614072f9eb757484243) |
| 22.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): when we decided to use double quotes for the `condition` field, we broke such queries on **H2**. This is because it behaves like Oracle and [converts unquoted identifiers to an upper case](https://stackoverflow.com/questions/10789994/make-h2-treat-quoted-name-and-unquoted-name-as-the-same), so the field is called `CONDITION` and when we quote it (`"condition"`), H2 couldn't find it because usage of the double quotes makes a field name case sensitive. Workaround: pass [`DATABASE_TO_UPPER=false`](https://www.h2database.com/javadoc/org/h2/engine/DbSettings.html#DATABASE_TO_UPPER) parameter to H2 to disable such behavior and be consistent with MySQL/PostgreSQL. Commits: [87df2dfa](https://github.com/php-coder/mystamps/commit/87df2dfabae9ef672fc8910139f3aadb46dd27d1) |
| 22.05.2020 Workaround | [php-coder/mystamps#1326](https://github.com/php-coder/mystamps/issues/1326): the field `condition` [has been added](https://github.com/php-coder/mystamps/commit/5648a0b121544e5326b22e801b0c23c502b59e3f) in order to persist a series condition. When we [started to use](https://github.com/php-coder/mystamps/commit/28eab066225a717d93fc95af2d947e45944f3ad1) the field, it has turned out that the SQL queries fail on **MySQL** because `condition` is a reserved keyword and should be quoted. We couldn't use apostrophes because it doesn't work on other databases. There was idea to rename the field to `cond`. Workaround: let's just double quote the field name as it should work everywhere and it's simpler. Commits: [74734a8d](https://github.com/php-coder/mystamps/commit/74734a8dc4071e9139efdf932750929869e9a370) |
| 22.05.2020 Workaround | [php-coder/mystamps#1398](https://github.com/php-coder/mystamps/issues/1398): After we switched to use HTTPS for a **0pdd** badge, it didn't show up in README.md file. Workaround: get back to using of HTTP in a link. Bug: [yegor256/0pdd#289](https://github.com/yegor256/0pdd/issues/289) Commits: [2d53575d](https://github.com/php-coder/mystamps/commit/2d53575d1c6a7b8ee9681d438fc4622e799e36c5) |
| 07.04.2020 Decision   | Add new type of change of commits: `improve` We need this because many changes in a series import are naturally fit into this category: they aren't new features as they are small, they aren't bugs as they were discovered during site usage. Unfortunately there is no related type in the current conventional commits specification. See discussions: [conventional-commits/conventionalcommits.org#66](https://github.com/conventional-commits/conventionalcommits.org/issues/66) and [conventional-commits/conventionalcommits.org#78](https://github.com/conventional-commits/conventionalcommits.org/issues/78) |
| 07.03.2020 Workaround | [php-coder/mystamps#1072](https://github.com/php-coder/mystamps/issues/1072): AJAX-related tests don't work in **htmlunit** and fail with `ReferenceError: "Headers" is not defined`. When the code got updated to use another version of constructor of `Headers` class, tests fail with error `ReferenceError: "fetch" is not defined` error. Bug: [HtmlUnit/htmlunit#78](https://github.com/HtmlUnit/htmlunit/issues/78) Workaround: because "the fetch api is not supported so far", let's use axios library instead. Commits: [f224e94](https://github.com/php-coder/mystamps/commit/f224e944b367036458ce9d7ce0c596504766ef8e) |
| ~~07.03.2020 Workaround~~ | ~~[php-coder/mystamps#1072](https://github.com/php-coder/mystamps/issues/1072): `sendKeys()` method from **htmlunit** fails with `StringIndexOutOfBoundsException: start > length()` exception when we fill a field again. Bug: [HtmlUnit/htmlunit#142](https://github.com/HtmlUnit/htmlunit/issues/142) Workaround: open a page on every test to avoid a state from other tests. Commits: [943afba](https://github.com/php-coder/mystamps/commit/943afba4f60b3df47e678a274186b80702e7562c)~~<br/>UPDATE(19.01.2021): in [dd61abf5](https://github.com/php-coder/mystamps/commit/dd61abf577e115a2d935fd0bc6d1f233046e6e85) the workaround has been reverted as since [c7e61df8](https://github.com/php-coder/mystamps/commit/c7e61df884ee4c1d418c5eacbb0267b98f75f1f0) we have the version that doesn't contain this bug |
| 09.02.2020 Workaround | **pdd** fails to parse files in charsets other than UTF-8 with error `invalid byte sequence in UTF-8`. Workaround: exclude `src/test/wiremock` directory. Bug: [yegor256/pdd#143](https://github.com/yegor256/pdd/issues/143) Commits: [30aab7d](https://github.com/php-coder/mystamps/commit/30aab7dc8c265804efef382422e7cae9e53187f3), [ab563b6](https://github.com/php-coder/mystamps/commit/ab563b653279625120121babccdfd915181ee46d) |
| 07.02.2020 Workaround | [php-coder/mystamps#1248](https://github.com/php-coder/mystamps/issues/1248): **wiremock** logs warnings for static resources when there is no stub mapping. Workaround: create mappings for such resources. Bug: [tomakehurst/wiremock#1247](https://github.com/tomakehurst/wiremock/issues/1247) Commits: [0018ad4](https://github.com/php-coder/mystamps/commit/0018ad44a21379b8179f94e954795c66b6d50bbc) |
| ~~24.11.2019 Workaround~~ | ~~[php-coder/mystamps#1156](https://github.com/php-coder/mystamps/issues/1156) After updating **html5validator** to 0.3.2, the `--ignore-re` has stopped to work. Workaround: revert and pin the version to 0.3.1 Bug: [svenkreiss/html5validator#64](https://github.com/svenkreiss/html5validator/issues/64) Commits: [9a0d695](https://github.com/php-coder/mystamps/commit/9a0d695ccac1deeba0c4280779bbac11ebf3ac4d)~~<br/> UPDATE(22.12.2020): in [61c97a4f](https://github.com/php-coder/mystamps/commit/61c97a4f2435e7cdf17c0ad6866f7b99cb640e3b) ([#1169](https://github.com/php-coder/mystamps/issues/1169)) html5validator has been updated to 0.3.3 that fixed the issue |
| 16.01.2019 Decision | [php-coder/mystamps#971](https://github.com/php-coder/mystamps/issues/971): One more tool for static analysis has been added: **errorprone**. I've disabled `MissingOverride` check because we use `@Getter` from Lombok that doesn't add `@Override` annotation by default. I think that placing a more complex annotation on every required field doesn't worth the effort. Commits: [6aeba7da9](https://github.com/php-coder/mystamps/commit/6aeba7da9aaf50298ec42b3259274048f452d4bf) |
| ~~16.01.2019 Workaround~~ | ~~[php-coder/mystamps#971](https://github.com/php-coder/mystamps/issues/971): I disabled **errorprone** `ParameterName` check to workaround an existing bug in the current version. Commits: [6aeba7da](https://github.com/php-coder/mystamps/commit/6aeba7da9aaf50298ec42b3259274048f452d4bf) Bug: [google/error-prone#780](https://github.com/google/error-prone/issues/780)~~<br/> UPDATE(25.05.2019): in [8a5542eb](https://github.com/php-coder/mystamps/commit/8a5542eb48e0da67837ccbf4d4d318bee4a7f4ff) `ParameterName` check has been enabled again after update to 2.3.3 version |
| 23.12.2018 Decision | [php-coder/mystamps#967](https://github.com/php-coder/mystamps/issues/967) "Show similar series" feature has been added with the following notes:<br/>- there is no limit for a number of series that will be displayed. I thought about limiting to 3 but I decided to leave it as-is for now<br/>- the order of the series isn't defined. In the initial idea, I thought about showing only 3 series in a random order but it's hard to implement in a database-agnostic way<br/>Commits: [054f826e](https://github.com/php-coder/mystamps/commit/054f826ef6706f82b4a7c04d73715d161d0c1a28) |
| 14.10.2018 Workaround | [php-coder/mystamps#76](https://github.com/php-coder/mystamps/issues/76) Because our existing infrastructure lives in Moscow time and data is stored in this format, I've configured **Docker container** to use `Europe/Moscow` timezone instead of UTC that was used by default. Commits: [8c4e9db2](https://github.com/php-coder/mystamps/commit/8c4e9db272b103818d74c94a68ba95d1b082d3a4) |
| 29.09.2018 Workaround | After [upgrade of **mysql-connector-java** to 5.1.47](https://github.com/php-coder/mystamps/commit/21e3a7a361990d6059cb7668c1217f653bd0ae8f), the bug that [causes NullPointerException](https://travis-ci.org/php-coder/mystamps/jobs/435000067) was revealed. I reverted the version back to 5.1.46 Issue: https://bugs.mysql.com/bug.php?id=92089 Commits: [3cb0dac9](https://github.com/php-coder/mystamps/commit/3cb0dac9fb62bbc12331b7ea1378f3b56746714d) |
| 30.12.2017 Workaround | [php-coder/mystamps#772](https://github.com/php-coder/mystamps/issues/772) Because **Travis CI** has **MySQL** version 5.6.43, we can't have a unique index on a column that has a length that exceeds 767 bytes. Our production server is running on 5.7.20 that doesn't have such limitation. In order to be able to run migrations on all the environments, I set type of the `series_import_requests.url` column to `VARCHAR(767)` (instead of `VARCHAR(768)` or `VARCHAR(1024)` as I wanted before). Commits: [33dd9025](https://github.com/php-coder/mystamps/commit/33dd902500501d3fdc3a744229ad921982adbc01) |
| 20.07.2017 Decision | [php-coder/mystamps#423](https://github.com/php-coder/mystamps/issues/423) Most of our **checks on CI** now get executed only when files of a certain type were modified. This should give us a faster feedback loop. Checks are also being run when their configuration has been changed. If check performed by a maven plugin, it will be always run when `pom.xml` is modified. The same logic applies to the tools that are being installed from the `.travis.yml` file. Unfortunately, we have to unconditionally run checks even if a change in a file wasn't related to the plugin/tool configuration. Also there is no way to disable skipping logic and if you need to run a specific check there is no way to force its execution. I was thinking about introducing an environment variable or using a special magic comment from a commit message but I decided to leave it as-is for a now (although it can be added later). Commits: [7da91a53](https://github.com/php-coder/mystamps/commit/7da91a53a1d7f43670d67adfce359814fa7ee27a) |
| 29.05.2017 Workaround | [php-coder/mystamps#588](https://github.com/php-coder/mystamps/issues/588) In order to import **test image** into database I had to move the image file from `src/test/resources` to `src/main/resources` directory because **Liquibase** is executing during the startup and it doesn't distinguish between test and main resources (it just searches in a class path). Commits: [646bb167](https://github.com/php-coder/mystamps/commit/646bb16706d3dc41fe8d613f101ac6679ac5cc92) |
| 06.05.2017 Decision | [php-coder/mystamps#517](https://github.com/php-coder/mystamps/issues/517) When we were implementing a suggestion link on the `/series/add` page, we had 2 options: return a suggestions as part of a page or request it later, as AJAX call, when page will be loaded in a browser. We have decided to stick with a second approach because **suggestion feature** is optional. We don't want to make more queries on the server side during page rendering. Commit: [9827abb9](https://github.com/php-coder/mystamps/commit/9827abb910f24432811017516d0a8f36d517752d) |
| 08.04.2017 Decision | At present we have 4 tests that are failing time to time. Until we fix them completely, they might fail builds and show PRs as having errors. Because **flaky tests** don't relate to code from PRs, this fact might frustrate contributors. To improve this situation I introduced **a special tag `unstable`** that can be added to flaky tests to ignore their failures. Commits: [56e848f7](https://github.com/php-coder/mystamps/commit/56e848f73b7a06691b886d4be156e3f95752afc0) |
| ~~24.02.2017 Workaround~~ | ~~[php-coder/mystamps#538](https://github.com/php-coder/mystamps/issues/538) `sed` (from Ubuntu 12.04) that is installed in **Travis CI** doesn't support `-z` option. I had to rewrite script on Perl as a workaround. Commits: [feea131a](https://github.com/php-coder/mystamps/commit/feea131a36f0cbae5c31a3826c4d061c878fe114), [aab6c7d9](https://github.com/php-coder/mystamps/commit/aab6c7d9735e7ae30d3434d27cda75832963a564), [54152eb2](https://github.com/php-coder/mystamps/commit/54152eb22bbfff1875afdadb9aac5b527a77bbeb)~~<br/> UPDATE(21.01.2020): because a proper solution has been found, the script, that we used as a workaround, has been removed in [e6ed0e85](https://github.com/php-coder/mystamps/commit/e6ed0e855f342abff2c5b1d3b3ac356d3dec2a47) |
| 06.01.2017 Workaround | [php-coder/mystamps#434](https://github.com/php-coder/mystamps/issues/434) I was needed to render categories with its subcategories. Database returns data in a form (sub category name + category name or null). It turns out that it's impossible to render this data with **Thymeleaf** as a `<select>` with `<optgroup>` elements. I had to do data transformation inside of a service method. Commits: [b7fe1dac](https://github.com/php-coder/mystamps/commit/b7fe1dac7a7f0bc09e9e153a8408687fd899c79f) Example: https://gist.github.com/php-coder/d3020e4d8d00b8c5befe755c46f06f1b |
| 28.09.2016 Workaround | Because **Travis CI** has **MySQL** version 5.5.53 (that is less than 5.6.5 but the latest for Ubuntu 12.04), we couldn't create a column with `NOW()` as a default value. We did the same in 3 steps to support this old version. Commits: [d55cd6cc](https://github.com/php-coder/mystamps/commit/d55cd6cc0842bc938c5c30f9aaaf78697ba84f45), [566d72f0](https://github.com/php-coder/mystamps/commit/566d72f053d785afb58234a6c7d69510a35bb7c4) |
| 30.01.2016 Workaround | **html5validator** complained about `An "img" element must have an "alt" attribute`. I've suppressed this error until [php-coder/mystamps#314](https://github.com/php-coder/mystamps/issues/314) is fixed. Commits: [ec40a6ad](https://github.com/php-coder/mystamps/commit/ec40a6ad431b77c922195bd3225a4963416cea43) |
| ~~14.08.2015 Workaround~~ | ~~When I added a dependency on **selectize.js** library, I found that it doesn't contain a minified version of the one of its resources (`selectize.bootstrap3.css`). While this doesn't affect production as we use CDN there, I have created an issue in the webjars repository anyway. Issue: https://github.com/webjars/selectize.js/issues/3 Commits: [3708eac0](https://github.com/php-coder/mystamps/commit/3708eac0c7f8554b0b26005567d22e5128cbc937)~~<br/>UPDATE(03.09.2015): because WebJar's author said that it's the issue with selectize.js, I have submitted request there: https://github.com/selectize/selectize.js/issues/899<br/>UPDATE(15.06.2022): in [b4412611](https://github.com/php-coder/mystamps/commit/b44126116239fcb905fa3cf362a9eb7b29084df7) ([#1520](https://github.com/php-coder/mystamps/issues/1520)) the library has been updated to 0.13.x version that contains minified CSS file |
