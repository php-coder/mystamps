<!DOCTYPE html>
<html lang="en" th:lang="${#locale.language == 'ru' ? 'ru' : 'en'}"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3"
	xmlns:togglz="https://github.com/heneke/thymeleaf-extras-togglz">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title th:text="|#{t_my_stamps}: #{t_series_info}|">My stamps: Info about series</title>
		<link rel="shortcut icon" type="image/x-icon" href="../../../favicon.ico" th:href="${FAVICON_ICO}" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" th:href="${BOOTSTRAP_CSS}" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/usrz/bootstrap-languages@3ac2a3d2b27ac43a471cd99e79d378a03b2c6b5f/languages.min.css" th:href="${BOOTSTRAP_LANGUAGE}" />
		<link rel="stylesheet" href="../../static/styles/main.css" th:href="${MAIN_CSS}" />
	</head>
	<body>
		<div class="container-fluid">
			<div class="row" id="header">
				<div id="logo" class="col-sm-9 vcenter">
					<a href="../site/index.html" th:href="'/'" th:text="#{t_my_stamps}">My stamps</a>
				</div><!--
				
				--><div class="col-sm-1 vcenter"
						th:with="lang=${#locale.language == 'en' ? 'ru' : 'en'},langName=${#locale.language == 'en' ? 'Русский' : 'English'}">
					<span class="lang-xs" lang="ru"
						th:lang="${lang}"></span>
					<a href="javascript:void(0)" hreflang="ru"
						th:href="|?lang=${lang}|" th:hreflang="${lang}" th:text="${langName}">Русский</a>
				</div><!--
				
				--><div id="user_bar" class="col-sm-2 vcenter">
					<ul class="list-unstyled">
						<li sec:authorize="isAuthenticated()">
							<i class="glyphicon glyphicon-user"></i>
							<a sec:authentication="principal.userName"
								href="../collection/info.html"
								title="Open my collection"
								th:title="#{t_open_my_collection}"
								th:href="@{${INFO_COLLECTION_PAGE}(slug=${#authentication.principal.userCollectionSlug})}">
								John Doe
							</a>
						</li>
						<!--/*/
						<li sec:authorize="isAnonymous()">
							<a href="../account/auth.html" th:href="@{${AUTHENTICATION_PAGE}}" th:text="#{t_enter}">Sign in</a>
						</li>
						/*/-->
						<li sec:authorize="isAuthenticated()">
							<form id="logout-form" method="get" action="../site/index.html" class="no-margin" th:method="post" th:action="@{${LOGOUT_PAGE}}">
								<i class="glyphicon glyphicon-share"></i>&nbsp;<input type="submit" value="Sign out" class="btn btn-link no-padding" th:value="#{t_logout}" />
							</form>
						</li>
						<!--/*/
						<li sec:authorize="isAnonymous()">
							<a href="../account/register.html" th:href="@{${REGISTRATION_PAGE}}" th:text="#{t_register}">Register</a>
						</li>
						/*/-->
					</ul>
				</div>
			</div>
			<div class="row" id="content">
				<div class="col-sm-12">
					
					<!--/*/
					<div class="row" th:if="${maxQuantityOfImagesExceeded}">
						<div class="alert alert-danger text-center col-sm-8 col-sm-offset-2" th:text="#{t_add_image_error}">
							This series has enough images. Please, contact with admin if you want to add more images
						</div>
					</div>
					/*/-->
					
					<div class="row">
						
						<div class="col-sm-4">
							<div class="row" th:each="imageId,iter : ${series.imageIds}">
								<div class="col-sm-12">
									<a id="series-image-link-1"
										target="_blank"
										href="../../../../resources/test/test.png"
										th:id="|series-image-link-${iter.count}|"
										th:href="@{${GET_IMAGE_PAGE}(id=${imageId})}">
										
										<img class="img-responsive series-images"
											id="series-image-1"
											src="../../../../resources/test/test.png"
											th:id="|series-image-${iter.count}|"
											th:src="@{${GET_IMAGE_PREVIEW_PAGE}(id=${imageId})}" />
									</a>
								</div>
							</div>
							
							<div class="row" th:if="${allowAddingImages or allowReplacingImages}">
								<div class="col-sm-10">
									<form id="add-image-form"
										method="post"
										class="form-horizontal"
										enctype="multipart/form-data"
										th:action="@{${ADD_IMAGE_SERIES_PAGE}(id=${series.id})}"
										th:object="${addImageForm}">
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('uploadedImage') ? 'has-error' : ''}">
											<label for="image"
												class="control-label col-sm-3"
												th:classappend="${#authorization.expression('hasAuthority(''DOWNLOAD_IMAGE'')') ? '' : 'required-field'}"
												th:text="#{t_image}">
												Image
											</label>
											<div class="col-sm-9">
												<input id="image"
													type="file"
													style="box-shadow: none; border: 0px;"
													accept="image/png,image/jpeg"
													th:field="*{uploadedImage}"
													th:attr="required=${#authorization.expression('hasAuthority(''DOWNLOAD_IMAGE'')') ? null : 'required'}" />
												<!--/*/
												<span id="image.errors" class="help-block" th:if="${#fields.hasErrors('uploadedImage')}" th:each="error : ${#fields.errors('uploadedImage')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										<div class="form-group form-group-sm"
											th:classappend="${#fields.hasErrors('imageUrl') or #fields.hasErrors('downloadedImage') ? 'has-error' : ''}"
											sec:authorize="hasAuthority('DOWNLOAD_IMAGE')">
											<label for="image-url" class="control-label col-sm-3" th:text="#{t_image_url}">
												Image URL
											</label>
											<div class="col-sm-9">
												<input type="url" id="image-url" class="form-control" th:field="*{imageUrl}" />
												<!--/*/
												<span id="image-url.errors" class="help-block" th:if="${#fields.hasErrors('imageUrl')}" th:each="error : ${#fields.errors('imageUrl')}" th:text="${error}"></span>
												<span id="image-url.errors" class="help-block" th:if="${#fields.hasErrors('downloadedImage')}" th:each="error : ${#fields.errors('downloadedImage')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										<div class="form-group form-group-sm">
											<div class="col-sm-offset-3 col-sm-8">
												<input type="submit" class="btn btn-primary btn-sm" value="Add image" th:value="#{t_add_image}" />
											</div>
										</div>
										<div class="form-group form-group-sm"
											th:classappend="${#fields.hasErrors('imageId') ? 'has-error' : ''}"
											th:if="${allowReplacingImages}">
											<label for="image-id" class="control-label col-sm-3 required-field" th:text="#{t_image_id}">
												Image ID
											</label>
											<div class="col-sm-4">
												<select id="image-id" th:field="*{imageId}" class="form-control">
													<option value="" th:text="#{t_not_chosen}">Not chosen</option>
													<!--/*/
													<option th:each="imageId : ${series.imageIds}" th:value="${imageId}" th:text="${imageId}"></option>
													/*/-->
													<!--/*-->
													<option value="1">1</option>
													<!--*/-->
												</select>
												<!--/*/
												<span id="image-id.errors"
													class="help-block"
													th:if="${#fields.hasErrors('imageId')}"
													th:each="error : ${#fields.errors('imageId')}"
													th:text="${error}">
												</span>
												/*/-->
											</div>
										</div>
										<div class="form-group form-group-sm" th:if="${allowReplacingImages}">
											<div class="col-sm-offset-3 col-sm-8">
												<!--/* @todo #1303 Replace image form: arrange submit buttons in a one line  */-->
												<input type="submit" class="btn btn-default btn-sm" name="replaceImage" value="Replace image" th:value="#{t_replace_image}" />
											</div>
										</div>
									</form>
								</div>
							</div>
							
							<div id="hide-image" class="row" sec:authorize="hasAuthority('HIDE_IMAGE')" th:if="${#lists.size(series.imageIds) > 1}"></div>
							
							<!--/* @todo #1356 Hidden images: add integration tests  */-->
							<!--/* @todo #1356 Hidden images: allow to replace a hidden image  */-->
							<!--/* @todo #1356 Hidden images: protect hidden images from direct access  */-->
							<div class="row" th:if="${not #lists.isEmpty(series.hiddenImageIds)}">
								<div class="col-sm-12">
									<h5 th:text="#{t_hidden_images}">Hidden images</h5>
								</div>
								<div class="col-sm-12" th:each="imageId,iter : ${series.hiddenImageIds}">
									<a id="series-hidden-image-link-1"
										target="_blank"
										href="../../../../resources/test/test.png"
										th:id="|series-hidden-image-link-${iter.count}|"
										th:href="@{${GET_IMAGE_PAGE}(id=${imageId})}">
										
										<img class="img-responsive series-images"
											 id="series-hidden-image-1"
											 src="../../../../resources/test/test.png"
											 th:id="|series-hidden-image-${iter.count}|"
											 th:src="@{${GET_IMAGE_PREVIEW_PAGE}(id=${imageId})}" />
									</a>
								</div>
								<!--/*-->
								<div class="col-sm-12">
									<a id="series-hidden-image-link-2" target="_blank" href="../../../../resources/test/test.png">
										<img class="img-responsive series-images" id="series-hidden-image-2" src="../../../../resources/test/test.png">
									</a>
								</div>
								<!--*/-->
							</div>
							
						</div>
						
						<div class="col-sm-4" th:with="isHtmx=${isHtmx ?: false},seriesId=${series.id}">
							<div class="row">
								<div class="col-sm-12">
									<dl id="series-info" class="dl-horizontal">
										<dt th:text="#{t_category}">
											Category
										</dt>
										<dd id="category_name">
											<a href="../category/info.html"
											   th:href="@{${INFO_CATEGORY_PAGE}(slug=${series.category.slug})}"
											   th:text="${series.category.name}">
												Animals
											</a>
										</dd>
										
										<!--/*/ <th:block th:if="${series.country != null}"> /*/-->
											<dt th:text="#{t_country}">
												Country
											</dt>
											<dd id="country_name">
												<a href="../country/info.html"
												   th:href="@{${INFO_COUNTRY_PAGE}(slug=${series.country.slug})}"
												   th:text="${series.country.name}">
													Italy
												</a>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${series.releaseYear != null}"> /*/-->
											<dt th:text="#{t_issue_date}">
												Date of release
											</dt>
											<dd id="issue_date">
												<span th:if="${series.releaseDay != null}"
													  th:text="|${#numbers.formatInteger(series.releaseDay, 2)}.|"
													  th:remove="tag">
													01.
												</span><span th:if="${series.releaseMonth != null}"
													  th:text="|${#numbers.formatInteger(series.releaseMonth, 2)}.|"
													  th:remove="tag">
													02.
												</span><span th:if="${series.releaseYear != null}"
													  th:text="${series.releaseYear}"
													  th:remove="tag">
													1999
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
											
											<dt th:text="#{t_quantity}">
												Quantity
											</dt>
											<dd id="quantity" th:text="${series.quantity}">
												7
											</dd>
											
											<dt th:text="#{t_perforated}">
												Perforated
											</dt>
											<dd id="perforated">
												<!--/*/ <th:block th:if="${series.perforated}"> /*/-->
													<span th:text="#{t_yes}">Yes</span> <i class="glyphicon glyphicon-ok"></i>
												<!--/*/ </th:block> /*/-->
												
												<!--/*/
												<th:block th:if="${not series.perforated}">
													<span th:text="#{t_no}">No</span> <i class="glyphicon glyphicon-remove"></i>
												</th:block>
												/*/-->
											</dd>
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(michelNumbers) or series.michel.price != null}"> /*/-->
											<dt th:text="#{t_michel}">
												Michel
											</dt>
											<dd id="michel_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(michelNumbers)},showPrice=${series.michel.price != null}">
												<span th:if="${showNumbers}" th:text="|#${michelNumbers}|" th:remove="tag">
													#101-104
												</span>
												<span th:if="${showPrice}"
													  th:with="showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.michel.formattedPrice} + ' EUR' +${showBrackets ? ')' : ''}"
													  th:remove="tag">
													(10 EUR)
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(scottNumbers) or series.scott.price != null}"> /*/-->
											<dt th:text="#{t_scott}">
												Scott
											</dt>
											<dd id="scott_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(scottNumbers)},showPrice=${series.scott.price != null}">
												<span th:if="${showNumbers}" th:text="|#${scottNumbers}|" th:remove="tag"></span>
												<span th:if="${showPrice}"
													  th:with="price=${#numbers.formatDecimal(series.scott.price, 1, 1)},showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.scott.formattedPrice} + ' USD' + ${showBrackets ? ')' : ''}"
													  th:remove="tag">
													12 USD
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(yvertNumbers) or series.yvert.price != null}"> /*/-->
											<dt th:text="#{t_yvert}">
												Yvert et Tellier
											</dt>
											<dd id="yvert_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(yvertNumbers)},showPrice=${series.yvert.price != null}">
												<span th:if="${showNumbers}" th:text="|#${yvertNumbers}|" th:remove="tag">
													#13, 17, 20
												</span>
												<span th:if="${showPrice}"
													  th:with="showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.yvert.formattedPrice} + ' EUR' + ${showBrackets ? ')' : ''}"
													  th:remove="tag">
													(7 EUR)
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(gibbonsNumbers) or series.gibbons.price != null}"> /*/-->
											<dt th:text="#{t_sg}">
												Stanley Gibbons
											</dt>
											<dd id="gibbons_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(gibbonsNumbers)},showPrice=${series.gibbons.price != null}">
												<span th:if="${showNumbers}" th:text="|#${gibbonsNumbers}|" th:remove="tag">
													#77, 79-83
												</span>
												<span th:if="${showPrice}"
													  th:with="showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.gibbons.formattedPrice} + ' GBP' + ${showBrackets ? ')' : ''}"
													  th:remove="tag">
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(solovyovNumbers) or series.solovyov.price != null}"> /*/-->
											<dt th:text="#{t_solovyov}">
												Solovyov
											</dt>
											<dd id="solovyov_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(solovyovNumbers)},showPrice=${series.solovyov.price != null}">
												<span th:if="${showNumbers}" th:text="|#${solovyovNumbers}|" th:remove="tag">
													#90, 93-95 (90 RUB)
												</span>
												<span th:if="${showPrice}"
													  th:with="showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.solovyov.formattedPrice} + ' RUB' + ${showBrackets ? ')' : ''}"
													  th:remove="tag">
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${not #strings.isEmpty(zagorskiNumbers) or series.zagorski.price != null}"> /*/-->
											<dt th:text="#{t_zagorski}">
												Zagorski
											</dt>
											<dd id="zagorski_catalog_info"
												th:with="showNumbers=${not #strings.isEmpty(zagorskiNumbers)},showPrice=${series.zagorski.price != null}">
												<span th:if="${showNumbers}" th:text="|#${zagorskiNumbers}|" th:remove="tag">
													#102, 111-113 (100 RUB)
												</span>
												<span th:if="${showPrice}"
													  th:with="showBrackets=${showNumbers and showPrice}"
													  th:text="${showBrackets ? '(' : ''} + ${series.zagorski.formattedPrice} + ' RUB' + ${showBrackets ? ')' : ''}"
													  th:remove="tag">
												</span>
											</dd>
										<!--/*/ </th:block> /*/-->
										
										<!--/*/ <th:block th:if="${importInfo != null}"> /*/-->
											<dt th:text="#{t_imported_from}">
												Imported from
											</dt>
											<dd id="import-info">
												<a id="import-request-link"
													href="./import/info.html"
													th:href="@{${REQUEST_IMPORT_PAGE}(id=${importInfo.requestId})}"
													th:text="${#uris.unescapePath(importInfo.url)}">
													http://example.com/my-first-series.html
												</a>
											</dd>
										<!--/*/ </th:block> /*/-->

										<!--/* NOTE: see also the same code in src/main/webapp/WEB-INF/views/series/partial/comment.html */-->
										<!--/*/ <th:block th:if="${series.comment != null and #authorization.expression('hasAuthority(''ADD_COMMENTS_TO_SERIES'')')}"> /*/-->
											<dt th:text="#{t_comment}">
												Comment
											</dt>
											<dd id="comment" th:utext="${#strings.replace(#strings.escapeXml(series.comment), T(java.lang.System).getProperty('line.separator'), '&lt;br /&gt;')}">
												My favorite series.
											</dd>
										<!--/*/ </th:block> /*/-->
									</dl>
								</div>
							</div>
							
							<div id="add-release-year" sec:authorize="hasAuthority('CREATE_SERIES')" th:if="${series.releaseYear == null}"></div>
							
							<div id="add-catalog-price" sec:authorize="hasAuthority('CREATE_SERIES')">
								<div class="col-sm-12 form-group">
									<form id="add-catalog-price-form" class="form-horizontal">
										<div class="form-group form-group-sm">
											<label for="price-catalog-name" class="control-label col-sm-3" th:text="#{t_catalog}">
												Catalog
											</label>
											<div class="col-sm-6">
												<select id="price-catalog-name" name="catalogName" class="form-control">
													<option value="MICHEL" th:text="#{t_michel}">Michel</option>
													<option value="SCOTT" th:text="#{t_scott}">Scott</option>
													<option value="YVERT" th:text="#{t_yvert}">Yvert et Tellier</option>
													<option value="GIBBONS" th:text="#{t_sg}">Stanley Gibbons</option>
													<option value="SOLOVYOV" th:text="#{t_solovyov}">Solovyov</option>
													<option value="ZAGORSKI" th:text="#{t_zagorski}">Zagorski</option>
												</select>
											</div>
										</div>
										<div class="form-group form-group-sm">
											<label for="catalog-price" class="control-label col-sm-3 required-field" th:text="#{t_price}">
												Price
											</label>
											<div class="col-sm-3">
												<div class="input-group">
													<span class="input-group-addon" id="js-catalog-price-symbol" >&euro;</span>
													<input id="catalog-price"
														type="text"
														class="form-control"
														size="5"
														title="EUR"
														required="required" />
												</div>
											</div>
										</div>
										<div class="col-sm-offset-3 col-sm-4">
											<button
												type="submit"
												class="btn btn-primary btn-sm"
												disabled
												th:text="#{t_add}">
												Add
											</button>
										</div>
									</form>
								</div>
							</div>

							<div id="add-catalog-numbers" class="row" sec:authorize="hasAuthority('CREATE_SERIES')">
								<div class="col-sm-12 form-group" th:fragment="AddCatalogNumbersForm">
									<form id="add-catalog-numbers-form"
										class="form-horizontal"
										th:object="${addCatalogNumbersForm}"
										hx-target="#add-catalog-numbers"
										hx-disabled-elt="#add-catalog-numbers-btn"
										th:hx-patch="@{${INFO_SERIES_PAGE}(id=${seriesId})}">
										<div class="alert alert-danger text-center col-sm-8 col-sm-offset-3 hidden server-error-msg"
											th:text="#{t_server_error}">
											Server error
										</div>
										<div class="form-group form-group-sm"
											th:classappend="${isHtmx and #fields.hasErrors('catalogName') ? 'has-error' : ''}">
											<label for="catalog-name"
												class="control-label col-sm-3"
												th:text="#{t_catalog}">
												Catalog
											</label>
											<div class="col-sm-6">
												<select id="catalog-name"
													name="catalogName"
													class="form-control"
													th:with="chosenCatalogName=${addCatalogNumbersForm != null and addCatalogNumbersForm.catalogName != null ? addCatalogNumbersForm.catalogName.name() : ''}">
													<option value="MICHEL" th:text="#{t_michel}" th:selected="${chosenCatalogName == 'MICHEL'}">
														Michel
													</option>
													<option value="SCOTT" th:text="#{t_scott}" th:selected="${chosenCatalogName == 'SCOTT'}">
														Scott
													</option>
													<option value="YVERT" th:text="#{t_yvert}" th:selected="${chosenCatalogName == 'YVERT'}">
														Yvert et Tellier
													</option>
													<option value="GIBBONS" th:text="#{t_sg}" th:selected="${chosenCatalogName == 'GIBBONS'}">
														Stanley Gibbons
													</option>
													<option value="SOLOVYOV" th:text="#{t_solovyov}" th:selected="${chosenCatalogName == 'SOLOVYOV'}">
														Solovyov
													</option>
													<option value="ZAGORSKI" th:text="#{t_zagorski}" th:selected="${chosenCatalogName == 'ZAGORSKI'}">
														Zagorski
													</option>
												</select>
												<!--/*/
												<th:block th:if="${isHtmx}">
													<span id="catalog-name.errors"
														class="help-block"
														th:if="${#fields.hasErrors('catalogName')}"
														th:each="error : ${#fields.errors('catalogName')}" th:text="${error}">
													</span>
												</th:block>
												/*/-->
											</div>
										</div>
										<div class="form-group form-group-sm"
											th:classappend="${isHtmx and #fields.hasErrors('catalogNumbers') ? 'has-error' : ''}">
											<label for="catalog-numbers"
												class="control-label col-sm-3 required-field"
												th:text="#{t_numbers}">
												Numbers
											</label>
											<div class="row">
												<div class="col-sm-6">
													<input id="catalog-numbers"
														name="catalogNumbers"
														type="text"
														class="form-control"
														size="5"
														required="required"
														placeholder="Example: 90-92,117"
														th:placeholder="|#{t_example}: 90-92,117|"
														th:value="${addCatalogNumbersForm != null ? addCatalogNumbersForm.catalogNumbers : ''}" />
													<!--/*/
													<th:block th:if="${isHtmx}">
														<span id="catalog-numbers.errors"
															class="help-block"
															th:if="${#fields.hasErrors('catalogNumbers')}"
															th:each="error : ${#fields.errors('catalogNumbers')}" th:text="${error}">
														</span>
													</th:block>
													/*/-->
												</div>
											</div>
										</div>
										<div class="col-sm-offset-3 col-sm-4">
											<button id="add-catalog-numbers-btn"
												type="submit"
												class="btn btn-primary btn-sm"
												th:text="#{t_add}">
												Add
											</button>
										</div>
									</form>
								</div>
							</div>
							
							<div id="add-comment"
								class="row"
								sec:authorize="hasAuthority('ADD_COMMENTS_TO_SERIES')"
								th:if="${series.comment == null}">
								<div class="col-sm-12 form-group" th:fragment="AddCommentForm">
									<form id="add-comment-form"
										class="form-horizontal"
										th:object="${addCommentForm}"
										hx-target="#add-comment"
										hx-select-oob="#series-info:beforeend"
										hx-disabled-elt="#add-comment-btn"
										th:hx-patch="@{${INFO_SERIES_PAGE}(id=${seriesId})}">
										<div class="alert alert-danger text-center col-sm-8 col-sm-offset-3 hidden server-error-msg"
											th:text="#{t_server_error}">
											Server error
										</div>
										<div class="form-group form-group-sm" th:classappend="${isHtmx and #fields.hasErrors('comment') ? 'has-error' : ''}">
											<label for="new-comment"
												class="control-label col-sm-3 required-field"
												th:text="#{t_comment}">
												Comment
											</label>
											<div class="col-sm-6">
												<textarea id="new-comment"
													name="comment"
													class="form-control"
													cols="22"
													rows="3"
													required="required"
													th:text="${addCommentForm != null ? addCommentForm.comment : ''}"></textarea>
												<!--/*/
												<th:block th:if="${isHtmx}">
													<span id="new-comment.errors"
														class="help-block"
														th:if="${#fields.hasErrors('comment')}"
														th:each="error : ${#fields.errors('comment')}" th:text="${error}">
													</span>
												</th:block>
												/*/-->
											</div>
										</div>
										<div class="col-sm-offset-3 col-sm-9">
											<button id="add-comment-btn"
												type="submit"
												class="btn btn-primary btn-sm"
												th:text="#{t_add}">
												Add
											</button>
										</div>
									</form>
								</div>
							</div>
							
							<div id="similar-series" class="row" th:if="${not #lists.isEmpty(similarSeries)}">
								<div class="col-sm-10 col-sm-offset-2">
									<h5 class="text-center" th:text="#{t_similar_series}">
										Similar series
									</h5>
									<ul th:remove="all-but-first">
										<li th:each="series : ${similarSeries}">
											<a href="../series/info.html" th:href="@{${INFO_SERIES_PAGE}(id=${series.id})}">
												<span th:remove="tag" th:if="${series.country != null}" th:text="|${series.country}, |">Italy, </span>
												<span th:remove="tag" th:if="${series.year != null}" th:text="|${series.year}, |">1999, </span>
												<span th:remove="tag" th:text="|${series.quantity}&nbsp;${series.quantity != 1 ? '__#{t_stamps}__' : '__#{t_stamp}__'}|">7&nbsp;stamps</span>
												<span th:remove="tag" th:if="${not series.perforated}" th:text="|(#{t_wo_perforation_short})|">(imperf.)</span>
											</a>
										</li>
										<li><a href="../series/info.html">Italy, 4&nbsp;stamps</a></li>
										<li><a href="../series/info.html">12&nbsp;stamps</a></li>
									</ul>
								</div>
							</div>
							
							<div id="mark-similar-series" sec:authorize="hasAuthority('MARK_SIMILAR_SERIES')"></div>
						</div>
						
						<div class="col-sm-4">
							
							<div class="row">
								<div class="col-sm-12" sec:authorize="hasAuthority('UPDATE_COLLECTION')">
									<form id="add-series-form" method="post" action="../collection/info.html"
										th:action="@{${INFO_SERIES_PAGE}(id=${series.id})}"
										th:object="${addToCollectionForm}">

										<p id="series-status-msg" th:unless="${#maps.isEmpty(seriesInstances)}" th:text="|#{t_series_in_collection}:|">
											You already have this series. Add another one instance:
										</p>
										
										<!--/*/
										<p id="series-status-msg" th:if="${#maps.isEmpty(seriesInstances)}" th:text="|#{t_series_not_in_collection}:|">
											You don't have this series. Add one instance:
										</p>
										/*/-->
										
										<p id="number-of-stamps-block" th:if="${series.quantity != 1}" class="form-inline">
											<span th:text="#{t_i_have}" th:remove="tag">I have</span>
											<input id="number-of-stamps"
												type="number"
												class="form-control input-sm number-input"
												required="required"
												min="1"
												max="7"
												value="7"
												th:min="${T(ru.mystamps.web.feature.series.SeriesValidation).MIN_STAMPS_IN_SERIES}"
												th:max="${series.quantity}"
												th:field="*{numberOfStamps}"
												/>
											<span th:text="#{t_out_of_n_stamps(${series.quantity})}" th:remove="tag">out of 7 stamps</span>
										</p>
										<!--/*/
										<p th:if="${#fields.hasErrors('numberOfStamps')}"
											th:classappend="${#fields.hasErrors('numberOfStamps') ? 'has-error' : ''}">
											<span id="number-of-stamps.errors"
												class="help-block"
												th:each="error : ${#fields.errors('numberOfStamps')}"
												th:text="${error}"></span>
										</p>
										/*/-->
										<p class="form-inline"
											th:with="price_msg=#{t_price},paidUser=${#authorization.expression('hasAuthority(''ADD_SERIES_PRICE'')')}"
											th:attrappend="title=${paidUser ? null : '__#{t_only_for_paid_users}__'}">
											
											<span th:text="#{t_i_bought_for}" th:remove="tag">I bought for</span>
											<input id="paid-price"
												class="form-control input-sm number-input"
												type="text"
												size="5"
												placeholder="price"
												th:placeholder="${#strings.unCapitalize(price_msg)}"
												th:field="*{price}"
												th:disabled="${paidUser ? null : 'disabled'}"
												/>
											<select id="paid-currency"
												class="form-control input-sm"
												th:field="*{currency}"
												th:disabled="${paidUser ? null : 'disabled'}">
												<option value=""></option>
												<option value="USD">USD</option>
												<option value="EUR">EUR</option>
												<option value="RUB">RUB</option>
												<option value="CZK">CZK</option>
												<option value="BYN">BYN</option>
												<option value="UAH">UAH</option>
											</select>
										</p>
										<!--/*/
										<p th:if="${#fields.hasErrors('price') or #fields.hasErrors('currency')}" th:classappend="has-error">
											<span id="paid-price.errors"
												class="help-block"
												th:each="error : ${#fields.errors('price')}"
												th:text="${error}"></span>
											<span id="paid-currency.errors"
												class="help-block"
												th:each="error : ${#fields.errors('currency')}"
												th:text="${error}"></span>
										</p>
										/*/-->
										<p>
											<input type="hidden" name="action" value="ADD" />
											<input type="hidden" name="seriesId" value="1" th:value="${series.id}" />
											<input type="hidden" name="numberOfStamps" value="1" th:if="${series.quantity == 1}" />
											<input type="submit" class="btn btn-success" value="Add to collection" th:value="#{t_add_to_collection}" />
										</p>
									</form>
								</div>
								
								<div class="col-sm-12" th:if="${not #maps.isEmpty(seriesInstances)}" sec:authorize="hasAuthority('UPDATE_COLLECTION')">
									<!--/*/
									<th:block th:each="entry : ${seriesInstances}" th:with="instanceId=${entry.key},numberOfStamps=${entry.value}">
									/*/-->
										<form class="remove-series-form" method="post" action="../collection/info.html" th:action="@{${INFO_SERIES_PAGE}(id=${series.id})}">
											<input type="hidden" name="id" th:value="${instanceId}" />
											<input type="hidden" name="action" value="REMOVE" />
											<p>
												<input type="submit" class="btn btn-xs btn-danger" value="Remove from collection" th:value="#{t_remove_from_collection}" />
												<span class="label label-default"
													th:if="${series.quantity != numberOfStamps}"
													th:text="#{t_m_out_of_n(${numberOfStamps}, ${series.quantity})}">
													3 out of 7
												</span>
											</p>
										</form>
									<!--/*/
									</th:block>
									/*/-->
									<!--/*-->
									<form class="remove-series-form" method="post" action="../collection/info.html">
										<input type="hidden" name="id" value="1" />
										<input type="hidden" name="action" value="REMOVE" />
										<p>
											<input type="submit" class="btn btn-xs btn-danger" value="Remove from collection" />
										</p>
									</form>
									<!--*/-->
								</div>
								
								<!--/*/
								<div class="col-sm-12" sec:authorize="isAnonymous()">
									<p th:utext="#{t_need_authentication_to_add_series_to_collection(@{${REGISTRATION_PAGE}}, @{${AUTHENTICATION_PAGE}})}">
										In order to add this series to your collection you should <a href="../account/register.html">register</a>
										or <a href="../account/auth.html">pass authentication</a>.
									</p>
								</div>
								/*/-->
							</div>
							
							<div class="row" th:if="${not #lists.isEmpty(seriesSales)}" sec:authorize="hasAuthority('VIEW_SERIES_SALES')" togglz:inactive="USE_REACT">
								<div class="col-sm-12">
									<h5 th:text="#{t_who_selling_series}">Who was selling/buying this series</h5>
									<ul th:remove="all-but-first">
										<li id="series-sale-1-info"
											th:id="|series-sale-${iter.count}-info|"
											th:each="transaction,iter : ${seriesSales}"
											th:with="firstPrice=${#numbers.formatDecimal(transaction.firstPrice, 0, 'DEFAULT', 2, 'DEFAULT') + '&nbsp;' + transaction.firstCurrency},
														 optionalSecondPrice=${transaction.secondPrice != null ? ('&nbsp;' + '(' + #numbers.formatDecimal(transaction.secondPrice, 0, 'DEFAULT', 2, 'DEFAULT') + '&nbsp;' + transaction.secondCurrency + ')') : ''}">
											<!--/*/
											<span th:if="${transaction.date != null}" th:remove="tag" th:text="${#dates.format(transaction.date, 'dd.MM.yyyy')}"></span>
											/*/-->
											<a href="http://example.com/james-alan-hetfield"
												id="series-sale-1-seller"
												rel="nofollow"
												th:id="|series-sale-${iter.count}-seller|"
												th:remove="${transaction.sellerUrl == null} ? tag"
												th:href="${transaction.sellerUrl}"
												th:text="${transaction.sellerName}">James Alan Hetfield</a>
											<span th:if="${transaction.buyerName == null}" th:remove="tag" th:text="#{t_was_selling_for}">was selling for</span>
											<!--/*/
											<th:block th:if="${transaction.buyerName != null}">
												<span th:text="#{t_sold_to}" th:remove="tag">sold to</span>
												<a href="http://example.com/eicca-toppinen" rel="nofollow" th:remove="${transaction.buyerUrl == null} ? tag" th:href="${transaction.buyerUrl}" th:text="${transaction.buyerName}">Eicca Toppinen</a>
												<span th:text="#{t_sold_for}" th:remove="tag">for</span>
											</th:block>
											/*/-->
											<a href="http://example.com/james-alan-hetfield/selling-stamps"
												id="series-sale-1-transaction"
												rel="nofollow"
												th:id="|series-sale-${iter.count}-transaction|"
												th:remove="${transaction.transactionUrl == null} ? tag"
												th:href="${transaction.transactionUrl}"
												th:text="${firstPrice + optionalSecondPrice}">100 USD</a>
											<!--/*/
											<th:block th:if="${transaction.condition != null}" th:switch="${transaction.condition.toString()}">
												<span th:text="|(${#strings.unCapitalize('__#{t_cancelled}__')})|" th:case=" 'CANCELLED' ">cancelled</span>
											/*/-->
												<span th:text="|(${transaction.condition})|" th:case="*">(MNH)</span>
											<!--/*/
											</th:block>
											/*/-->
										</li>
										<li id="series-sale-2-info">
											<a href="http://example.com/james-alan-hetfield" id="series-sale-2-seller" rel="nofollow">James Alan Hetfield</a> was selling for <a href="http://example.com/james-alan-hetfield/selling-stamps" id="series-sale-2-transaction" rel="nofollow">100 USD (650 RUB)</a>
										</li>
										<li id="series-sale-3-info">
											02.02.2002 <a href="http://example.com/tommy-lee-jones" id="series-sale-3-seller" rel="nofollow">Tommy Lee Jones</a> was selling for <a href="http://example.com/tommy-lee-jones/selling-stamps" id="series-sale-3-transaction" rel="nofollow">200 USD</a>
											(cancelled)
										</li>
										<li id="series-sale-4-info">
											02.02.2002 <a href="http://example.com/tommy-lee-jones" id="series-sale-4-seller" rel="nofollow">Tommy Lee Jones</a> was selling for <a href="http://example.com/tommy-lee-jones/selling-stamps" id="series-sale-4-transaction" rel="nofollow">200 USD (1300 RUB)</a>
										</li>
										<li id="series-sale-5-info">
											03.03.2003 <a href="http://example.com/eicca-toppinen" id="series-sale-5-seller" rel="nofollow">Eicca Toppinen</a> sold to <a href="http://example.com/kurt-cobain" rel="nofollow">Kurt Cobain</a> for <a href="http://example.com/eicca-toppinen/selling-stamps" id="series-sale-5-transaction" rel="nofollow">300 USD</a>
											(MVLH)
										</li>
										<li id="series-sale-6-info">
											03.03.2003 <a href="http://example.com/eicca-toppinen" id="series-sale-6-seller" rel="nofollow">Eicca Toppinen</a> sold to Michael Jackson for <a href="http://example.com/eicca-toppinen/selling-stamps" id="series-sale-6-transaction" rel="nofollow">300 USD (1560 RUB)</a>
										</li>
									</ul>
								</div>
							</div>
							
							<div id="series-sales-list" sec:authorize="hasAuthority('VIEW_SERIES_SALES')" togglz:active="USE_REACT"></div>
						
							<div class="row" sec:authorize="hasAuthority('ADD_SERIES_SALES')">
								<div class="col-sm-12">
									<h5 th:text="#{t_add_info_who_selling_series}">Add info about selling/buying this series</h5>
									<form id="add-series-sales-form"
										method="post"
										class="form-horizontal"
										action="info.html"
										th:action="@{${ADD_SERIES_ASK_PAGE}(id=${series.id})}"
										th:object="${addSeriesSalesForm}">
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('date') ? 'has-error' : ''}">
											<label for="date" class="control-label col-sm-3" th:text="#{t_date}">
												Date
											</label>
											<div class="col-sm-4">
												<input type="text" id="date" class="form-control" th:field="*{date}" th:placeholder="#{t_dd_mm_yyyy}" placeholder="dd.mm.yyyy" />
												<!--/*/
												<span id="date.errors" class="help-block" th:if="${#fields.hasErrors('date')}" th:each="error : ${#fields.errors('date')}" th:text="${error}"></span>
												/*/-->
											</div>
											<small>
												<a tabindex="-1"
													class="link-vcenter"
													href="javascript:populateTransactionDateWithTodayDate(); void(0);" th:text="#{t_today}">
													Today
												</a>
											</small>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('sellerId') ? 'has-error' : ''}">
											<label for="seller" class="control-label col-sm-3 required-field" th:text="#{t_seller}">
												Seller
											</label>
											<div class="col-sm-6">
												<select id="seller" class="form-control" required="required" th:field="*{sellerId}">
													<option value="" th:text="#{t_not_chosen_masculine}">Not chosen</option>
													<!--/*/
													<th:block th:each="item : ${sellers}">
														<optgroup th:if="${not #lists.isEmpty(item.children)}" th:label="${item.name}">
															<option th:each="seller : ${item.children}"
																th:value="${seller.value}"
																th:text="${seller.name}"
																th:selected="${addSeriesSalesForm.sellerId != seller.value}">
															</option>
														</optgroup>
														<option th:if="${#lists.isEmpty(item.children)}"
															th:value="${item.value}"
															th:text="${item.name}"
															th:selected="${addSeriesSalesForm.sellerId != item.value}">
														</option>
													</th:block>
													/*/-->
													<!--/*-->
													<optgroup label="Musicians">
														<option value="3">Eicca Toppinen</option>
														<option value="1">James Alan Hetfield</option>
													</optgroup>
													<option value="2">Tommy Lee Jones</option>
													<!--*/-->
												</select>
												<small sec:authorize="hasAuthority('ADD_PARTICIPANT')">
													<span class="hint-block">
														<a tabindex="-1"
															href="../participant/add.html?seller=true"
															th:href="@{${ADD_PARTICIPANT_PAGE}(seller=true)}"
															th:text="#{t_add_new_seller}">
															Add a new seller
														</a>
													</span>
												</small>
												<!--/*/
												<span id="seller.errors" class="help-block" th:if="${#fields.hasErrors('sellerId')}" th:each="error : ${#fields.errors('sellerId')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('url') ? 'has-error' : ''}">
											<label for="url" class="control-label col-sm-3" th:text="#{t_url}">
												URL
											</label>
											<div class="col-sm-6">
												<input type="url" id="url" class="form-control" th:field="*{url}" />
												<!--/*/
												<span id="url.errors" class="help-block" th:if="${#fields.hasErrors('url')}" th:each="error : ${#fields.errors('url')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('price') or #fields.hasErrors('currency') ? 'has-error' : ''}">
											<label for="price" class="control-label col-sm-3 required-field" th:text="#{t_price}">
												Price
											</label>
											<div class="col-sm-6">
												<div class="row">
													<div class="col-xs-6">
														<input type="text" id="price" class="form-control" size="5" required="required" th:field="*{price}" />
													</div>
													<div class="col-xs-4 no-padding">
														<select id="currency" class="form-control" required="required" th:field="*{currency}">
															<option value=""></option>
															<option value="USD">USD</option>
															<option value="EUR">EUR</option>
															<option value="GBP">GBP</option>
															<option value="RUB" selected="selected">RUB</option>
															<option value="CZK">CZK</option>
															<option value="BYN">BYN</option>
															<option value="UAH">UAH</option>
														</select>
													</div>
												</div>
												<!--/*/
												<span id="price.errors" class="help-block" th:if="${#fields.hasErrors('price')}" th:each="error : ${#fields.errors('price')}" th:text="${error}"></span>
												<span id="currency.errors" class="help-block" th:if="${#fields.hasErrors('currency')}" th:each="error : ${#fields.errors('currency')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('altPrice') or #fields.hasErrors('altCurrency') ? 'has-error' : ''}">
											<label for="alt-price" class="control-label col-sm-3" th:text="#{t_alternative_price}">
												Alternative price
											</label>
											<div class="col-sm-6">
												<div class="row">
													<div class="col-xs-6">
														<input type="text" id="alt-price" class="form-control" size="5" th:field="*{altPrice}" />
													</div>
													<div class="col-xs-4 no-padding">
														<select id="alt-currency" class="form-control" th:field="*{altCurrency}">
															<option value=""></option>
															<option value="USD">USD</option>
															<option value="EUR">EUR</option>
															<option value="GBP">GBP</option>
															<option value="RUB">RUB</option>
															<option value="CZK">CZK</option>
															<option value="BYN">BYN</option>
															<option value="UAH">UAH</option>
														</select>
													</div>
												</div>
												<!--/*/
												<span id="alt-price.errors" class="help-block" th:if="${#fields.hasErrors('altPrice')}" th:each="error : ${#fields.errors('altPrice')}" th:text="${error}"></span>
												<span id="alt-currency.errors" class="help-block" th:if="${#fields.hasErrors('altCurrency')}" th:each="error : ${#fields.errors('altCurrency')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('condition') ? 'has-error' : ''}">
											<label for="condition" class="control-label col-sm-3" th:text="#{t_condition}">
												Condition
											</label>
											<div class="col-sm-3">
												<select id="condition" class="form-control" th:field="*{condition}">
													<option value=""></option>
													<option value="MNH">MNH</option>
													<option value="MNHOG">MNHOG</option>
													<option value="MVLH">MVLH</option>
													<option value="CTO">CTO</option>
													<option value="CANCELLED" th:text="#{t_cancelled}">Сancelled</option>
												</select>
												<!--/*/
												<span id="condition.errors" class="help-block" th:if="${#fields.hasErrors('condition')}" th:each="error : ${#fields.errors('condition')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm" th:classappend="${#fields.hasErrors('buyerId') ? 'has-error' : ''}">
											<label for="buyer" class="control-label col-sm-3" th:text="#{t_buyer}">
												Buyer
											</label>
											<div class="col-sm-6">
												<select id="buyer" class="form-control" th:field="*{buyerId}">
													<option value="" th:text="#{t_not_chosen_masculine}">Not chosen</option>
													<!--/*/
														<th:block th:each="item : ${buyers}">
															<optgroup th:if="${not #lists.isEmpty(item.children)}" th:label="${item.name}">
																<option th:each="buyer : ${item.children}"
																	th:value="${buyer.value}"
																	th:text="${buyer.name}"
																	th:selected="${addSeriesSalesForm.buyerId != buyer.value}">
																</option>
															</optgroup>
															<option th:if="${#lists.isEmpty(item.children)}"
																th:value="${item.value}"
																th:text="${item.name}"
																th:selected="${addSeriesSalesForm.buyerId != item.value}">
															</option>
														</th:block>
													/*/-->
													<!--/*-->
													<optgroup label="Musicians">
														<option value="1">Kurt Cobain</option>
														<option value="2">Michael Jackson</option>
													</optgroup>
													<!--*/-->
												</select>
												<small sec:authorize="hasAuthority('ADD_PARTICIPANT')">
													<span class="hint-block">
														<a tabindex="-1"
															href="../participant/add.html?buyer=true"
															th:href="@{${ADD_PARTICIPANT_PAGE}(buyer=true)}"
															th:text="#{t_add_new_buyer}">
															Add a new buyer
														</a>
													</span>
												</small>
												<!--/*/
												<span id="buyer.errors" class="help-block" th:if="${#fields.hasErrors('buyerId')}" th:each="error : ${#fields.errors('buyerId')}" th:text="${error}"></span>
												/*/-->
											</div>
										</div>
										
										<div class="form-group form-group-sm">
											<div class="col-sm-offset-3 col-sm-4">
												<input type="submit" class="btn btn-primary btn-sm" value="Add info" th:value="#{t_add_info}" />
											</div>
										</div>
										
									</form>
								</div>
							</div>

							<!--/* @todo #995 Series sale import: add support for new sellers */-->
							<!--/* @todo #1057 Series sale import form: show a message when JavaScript is disabled */-->
							<div id="import-series-sale" sec:authorize="hasAuthority('IMPORT_SERIES_SALES')"></div>
							
						</div>
						
					</div>
					
				</div>
			</div>
			
			<div class="row">
				<footer class="col-sm-12 text-right">
					<i class="glyphicon glyphicon-envelope"></i>
					<a href="mailto:slava.semushin@gmail.com" title="Write e-mail" th:href="|mailto:#{t_site_author_email}|" th:title="#{t_write_email}" th:text="#{t_site_author_name}">Slava Semushin</a>, 2009-2025
				</footer>
			</div>
		</div>
		
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="http://yandex.st/jquery/1.9.1/jquery.min.js" th:src="${JQUERY_JS}"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" th:src="${BOOTSTRAP_JS}"></script>
		
		<script sec:authorize="hasAnyAuthority('VIEW_SERIES_SALES', 'IMPORT_SERIES_SALES')"
			src="../../../../../../target/classes/js/utils/DateUtils.min.js"
			th:src="${DATE_UTILS_JS}"></script>

		<script sec:authorize="hasAnyAuthority('VIEW_SERIES_SALES', 'CREATE_SERIES')"
			src="../../../../javascript/series/info.js"
			th:src="${SERIES_INFO_JS}"></script>
		
		<script sec:authorize="hasAuthority('CREATE_SERIES')">
			window.addEventListener('DOMContentLoaded', function initPage() {
				var catalogNameElem = document.getElementById('price-catalog-name');
				if (catalogNameElem == null) {
					console.error("Couldn't initialize catalog name selector: element not found");
					return;
				}
				catalogNameElem.addEventListener('change', function changeCatalogCurrency(elem) {
					var name = this.value;
					var info = getCurrencyByCatalogName(this.value);
					var symbolElem = document.getElementById('js-catalog-price-symbol');
					if (symbolElem == null) {
						console.error("Couldn't change currency symbol: element not found");
					}
					var titleElem = document.getElementById('catalog-price');
					if (titleElem == null) {
						console.error("Couldn't change currency title: element not found");
					}
					symbolElem.innerText = info[0];
					titleElem.title = info[1];
				});
			});
		</script>
		
		<!--/*/
		<th:block sec:authorize="hasAnyAuthority('IMPORT_SERIES_SALES', 'MARK_SIMILAR_SERIES', 'CREATE_SERIES', 'ADD_COMMENTS_TO_SERIES', 'HIDE_IMAGE')">
		/*/-->
		<script src="https://unpkg.com/react@16.8.6/umd/react.development.js" th:src="${REACT_JS}"></script>
		<script src="https://unpkg.com/react-dom@16.8.6/umd/react-dom.development.js" th:src="${REACT_DOM_JS}"></script>
		<script src="https://unpkg.com/axios@0.19.2/dist/axios.js" th:src="${AXIOS_JS}"></script>
		<script src="https://unpkg.com/htmx.org@2.0.4/dist/htmx.js" th:src="${HTMX_JS}"></script>
		<!--/*/
		<script th:inline="javascript">
			// See for details: https://htmx.org/docs/#configuration-options
			htmx.config.selfRequestsOnly = true;
			htmx.config.allowScriptTags = false;
			htmx.config.historyCacheSize = 0;
			htmx.config.allowEval = false;
			
			// https://htmx.org/events/#htmx:configRequest
			document.body.addEventListener('htmx:configRequest', function configRequestHandler(event) {
				if (event.detail.verb !== 'get') {
					var csrfHeaderName = [[ ${_csrf.headerName} ]];
					var csrfTokenValue = [[ ${_csrf.token} ]];
					event.detail.headers[csrfHeaderName] = csrfTokenValue;
					
					event.detail.headers['Cache-Control'] = 'no-store';
				}
			});
			
			// https://htmx.org/events/#htmx:beforeSwap
			document.body.addEventListener('htmx:beforeSwap', function beforeSwapHandler(event) {
				if (event.detail.xhr.status === 422) {
					// allow swap in order to render form errors
					event.detail.shouldSwap = true;
					// don't treat it as error and don't log in console
					event.detail.isError = false;
				
				} else if (event.detail.xhr.status !== 200) {
					var errorMessage = event.target.querySelector('.server-error-msg');
					if (errorMessage != null) {
						errorMessage.classList.remove('hidden');
					} else {
						console.error(event);
					}
				}
			});
		</script>
		/*/-->
		<script th:inline="javascript">
			var renderComponent = function(component, props, elementId) {
				var rootElement = React.createElement(component, props);
				var destNode = document.getElementById(elementId);
				ReactDOM.render(rootElement, destNode);
			};
			
			/*[- */
			var responseCount = 0;
			window.axios = {
				post: function(url) {
					var possibleOutcomes = [ 'failOnForm', 'failOnField', 'success' ];
					var outcome = possibleOutcomes[responseCount % possibleOutcomes.length];
					var possibleResponses = {
						'/series/similar': {
							'failOnField': {
								status: 400,
								data: {
									'fieldErrors': {
										'seriesId': [ 'Invalid series id' ]
									}
								}
							},
							'success': {
								status: 204,
								data: {}
							}
						},
						'/series/100/image': {
							'failOnField': {
								status: 400,
								data: {
									'fieldErrors': {
										'imageId': [ 'Invalid image id' ]
									}
								}
							},
							'success': {
								status: 204,
								data: {}
							}
						},
						'/series/sales/import': {
							'failOnField': {
								status: 400,
								data: {
									'fieldErrors': {
										'url': [ 'Invalid value' ]
									}
								}
							},
							'success': {
								status: 200,
								data: {
									'sellerId': 3,
									'price': 3.5,
									'currency' : 'USD',
									'altPrice': 100,
									'altCurrency' : 'CZK'
								}
							}
						}						
					};
					var stubResponse;

					switch (outcome) {
						case 'success':
						case 'failOnField':
							stubResponse = possibleResponses[url][outcome];
							break;
						case 'failOnForm':
						default:
							stubResponse = {
								status: 500,
								statusText: 'Fake Server Error'
							};
					}

					responseCount++;

					return new Promise(function delayExecution(resolve, reject) {
						setTimeout(
							function returnResponse() {
								stubResponse.status == 500 ? reject(stubResponse) : resolve(stubResponse);
							},
							500 /* 0.5 second */
						);
					});
				},
				patch: function (url) {
					var possibleOutcomes = [ 'failOnForm', 'failOnField', 'success' ];
					var outcome = possibleOutcomes[responseCount % possibleOutcomes.length];
					var possibleResponses = {
						'/series/100': {
							'failOnField': {
								status: 400,
								data: {
									'fieldErrors': {
										'value': [ 'Invalid value' ]
									}
								}
							},
							'success': {
								status: 200,
								data: {}
							}
						}
					};
					var stubResponse;
					
					switch (outcome) {
						case 'success':
						case 'failOnField':
							stubResponse = possibleResponses[url][outcome];
							break;
						case 'failOnForm':
						default:
							stubResponse = {
								status: 500,
								statusText: 'Fake Server Error'
							};
					}
					
					responseCount++;
					
					return new Promise(function delayExecution(resolve, reject) {
						setTimeout(
							function returnResponse() {
								stubResponse.status == 500 ? reject(stubResponse) : resolve(stubResponse);
							},
							500 /* 0.5 second */
						);
					});
				},
				get: function (url) {
					var outcome = 'success';
					var possibleResponses = {
						'/series/100': {
							'success': {
								status: 200,
								data: [
									{
										id: 1,
										sellerName: 'James Alan Hetfield',
										sellerUrl: 'http://example.com/james-alan-hetfield',
										buyerName: 'Eicca Toppinen',
										buyerUrl: 'http://example.com/eicca-toppinen',
										transactionUrl: 'http://example.com/james-alan-hetfield/selling-stamps',
										firstPrice: 100,
										firstCurrency: 'USD',
										condition: 'CANCELLED'
									},
									{
										id: 2,
										sellerName: 'James Alan Hetfield',
										sellerUrl: 'http://example.com/james-alan-hetfield',
										transactionUrl: 'http://example.com/james-alan-hetfield/selling-stamps',
										firstPrice: 100,
										firstCurrency: 'USD',
										secondPrice: 650,
										secondCurrency: 'RUB',
										condition: 'CANCELLED'
									},
									{
										id: 3,
										date: '02.02.2002',
										sellerName: 'Tommy Lee Jones',
										sellerUrl: 'http://example.com/tommy-lee-jones',
										transactionUrl: 'http://example.com/tommy-lee-jones/selling-stamps',
										firstPrice: 200,
										firstCurrency: 'USD',
										condition: 'MNH'
									},
									{
										id: 4,
										date: '02.02.2002',
										sellerName: 'Tommy Lee Jones',
										sellerUrl: 'http://example.com/tommy-lee-jones',
										transactionUrl: 'http://example.com/tommy-lee-jones/selling-stamps',
										firstPrice: 200,
										firstCurrency: 'USD',
										secondPrice: 1300,
										secondCurrency: 'RUB',
									},
									{
										id: 5,
										date: '03.02.2002',
										sellerName: 'Eicca Toppinen',
										sellerUrl: 'http://example.com/eicca-toppinen',
										transactionUrl: 'http://example.com/tommy-lee-jones/selling-stamps',
										firstPrice: 300,
										firstCurrency: 'USD',
										secondPrice: 1560,
										secondCurrency: 'RUB',
									},
									{
										id: 6,
										date: '03.02.2002',
										sellerName: 'Eicca Toppinen',
										sellerUrl: 'http://example.com/eicca-toppinen',
										buyerName: 'Kurt Cobain',
										firstPrice: 300,
										firstCurrency: 'USD',
										secondPrice: 1560,
										secondCurrency: 'RUB',
									}
								]
							}
						}
					};
					var stubResponse;
					
					switch (outcome) {
						case 'success':
							stubResponse = possibleResponses[url][outcome];
							break;
						default:
							stubResponse = {
								status: 500,
								statusText: 'Fake Server Error'
							};
					}
					
					return new Promise(function returnResponse(resolve, reject) {
						if (stubResponse.status == 500) {
							reject(stubResponse);
						} else {
							resolve(stubResponse);
						}
					});
				}
			};
			/* -]*/
		</script>
		<!--/*/
		</th:block>
		/*/-->
		
		<!--/*/
		<th:block sec:authorize="hasAuthority('CREATE_SERIES')">
		/*/-->
		<script src="../../../../../../target/classes/js/components/AddReleaseYearForm.min.js" th:src="${RELEASE_YEAR_FORM_JS}"></script>

		<script th:inline="javascript">
			/*[- */
			var addReleaseYearProps = {
				'url': '/series/100',
				'l10n': {},
				'sinceYear': 1840,
				'tillYear': new Date().getFullYear()
			};
			/* -]*/
			
			/*[# th:if="${series.releaseYear == null}"]*/
			/*[+
			var addReleaseYearProps = {
				'url': [[ '__@{${INFO_SERIES_PAGE}(id=${series.id})}__' ]],
				'csrfHeaderName': [[ ${_csrf.headerName} ]],
				'csrfTokenValue': [[ ${_csrf.token} ]],
				'l10n': {
					't_server_error': [[ #{t_server_error} ]],
					't_year':         [[ #{t_year} ]],
					't_add':          [[ #{t_add} ]]
				},
				'sinceYear': [[ ${T(ru.mystamps.web.feature.series.SeriesValidation).MIN_RELEASE_YEAR} ]],
				'tillYear': new Date().getFullYear()
			};
			renderComponent(AddReleaseYearForm, addReleaseYearProps, 'add-release-year');
			+]*/
			/*[/]*/
			
			/*[- */
			renderComponent(AddReleaseYearForm, addReleaseYearProps, 'add-release-year');
			/* -]*/
		</script>
		<!--/*/
		</th:block>
		/*/-->
		
		<!--/*/
		<th:block sec:authorize="hasAuthority('VIEW_SERIES_SALES')" togglz:active="USE_REACT">
		/*/-->
		<script src="../../../../../../target/classes/js/components/SeriesSalesList.min.js" th:src="${SERIES_SALES_LIST_JS}"></script>
		
		<script th:inline="javascript">
			/*[+
			var seriesSalesListProps = {
				'url': [[ '__@{${INFO_SERIES_PAGE}(id=${series.id})}__' ]],
				'l10n': {
					't_server_error':       [[ #{t_server_error} ]],
					't_who_selling_series': [[ #{t_who_selling_series} ]],
					't_sold_to':            [[ #{t_sold_to} ]],
					't_sold_for':           [[ #{t_sold_for} ]],
					't_was_selling':        [[ #{t_was_selling} ]],
					't_cancelled':          [[ #{t_cancelled} ]]
				}
			};
			+]*/
			
			/*[- */
			var seriesSalesListProps = {
				'url': '/series/100',
				'l10n': {}
			};
			/* -]*/
			
			renderComponent(SeriesSalesList, seriesSalesListProps, 'series-sales-list');
		</script>
		<!--/*/
		</th:block>
		/*/-->

		<!--/* @todo #1280 Mark similar series: add integration tests */-->
		<!--/*/
		<th:block sec:authorize="hasAuthority('MARK_SIMILAR_SERIES')">
		/*/-->
		<script src="../../../../../../target/classes/js/utils/CatalogUtils.min.js" th:src="${CATALOG_UTILS_JS}"></script>
		<script src="../../../../../../target/classes/js/components/SimilarSeriesForm.min.js" th:src="${SIMILAR_SERIES_FORM_JS}"></script>
		<script th:inline="javascript">
			/*[+
			var similarSeriesProps = {
				'seriesId': [[ ${series.id} ]],
				'url': [[ '__@{${MARK_SIMILAR_SERIES}}__' ]],
				'csrfHeaderName': [[ ${_csrf.headerName} ]],
				'csrfTokenValue': [[ ${_csrf.token} ]],
				'l10n': {
					't_server_error':    [[ #{t_server_error} ]],
					't_mark_as_similar': [[ #{t_mark_as_similar} ]],
					't_example':         [[ #{t_example} ]],
				}
			};
			+]*/
			
			/*[- */
			var similarSeriesProps = {
				'seriesId': 1,
				'url': '/series/similar',
				'l10n': {}
			};
			/* -]*/
			
			renderComponent(SimilarSeriesForm, similarSeriesProps, 'mark-similar-series');
		</script>
		<!--/*/
		</th:block>
		/*/-->
		
		<!--/*/
		<th:block sec:authorize="hasAuthority('IMPORT_SERIES_SALES')">
		/*/-->
		<script src="../../../../../../target/classes/js/components/SeriesSaleImportForm.min.js" th:src="${SALE_IMPORT_FORM_JS}"></script>
		<script th:inline="javascript">
			/*[+
			var seriesSaleImportProps = {
				'url': [[ '__@{${IMPORT_SERIES_SALES}}__' ]],
				'csrfHeaderName': [[ ${_csrf.headerName} ]],
				'csrfTokenValue': [[ ${_csrf.token} ]],
				'l10n': {
					't_import_info_who_selling_series': [[ #{t_import_info_who_selling_series} ]],
					't_could_not_import_info':          [[ #{t_could_not_import_info} ]],
					't_url':                            [[ #{t_url} ]],
					't_import_info':                    [[ #{t_import_info} ]]
				}
			};
			+]*/
			
			/*[- */
			var seriesSaleImportProps = {
				'url': '/series/sales/import',
				'l10n': {}
			};
			/* -]*/
			
			renderComponent(SeriesSaleImportForm, seriesSaleImportProps, 'import-series-sale');
		</script>
		<!--/*/
		</th:block>
		/*/-->
		
		<!--/*/
		<th:block sec:authorize="hasAuthority('HIDE_IMAGE')" th:if="${#lists.size(series.imageIds) > 1}">
		/*/-->
		<script src="../../../../../../target/classes/js/components/HideImageForm.min.js" th:src="${HIDE_IMAGE_FORM_JS}"></script>
		<script th:inline="javascript">
			/*[+
			var hideImageProps = {
				'url': [[ '__@{${ADD_IMAGE_SERIES_PAGE}(id=${series.id})}__' ]],
				'imageIds': [[ ${series.imageIds} ]],
				'csrfHeaderName': [[ ${_csrf.headerName} ]],
				'csrfTokenValue': [[ ${_csrf.token} ]],
				'l10n': {
					't_image_id':     [[ #{t_image_id} ]],
					't_server_error': [[ #{t_server_error} ]],
					't_not_chosen':   [[ #{t_not_chosen} ]],
					't_hide_image':   [[ #{t_hide_image} ]]
				}
			};
			+]*/
			
			/*[- */
			var hideImageProps = {
				'url': '/series/100/image',
				'l10n': {},
				'imageIds': [ 1 ]
			};
			/* -]*/
			
			renderComponent(HideImageForm, hideImageProps, 'hide-image');
		</script>
		<!--/*/
		</th:block>
		/*/-->
		
	</body>
</html>
